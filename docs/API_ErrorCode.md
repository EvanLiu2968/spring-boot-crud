# API 错误码

- 格式
- 系统级错误码
- 业务模块错误码
  - 业务对应编码
  - 业务错误码
- 补充说明
  - 关于HTTP状态码
  - 错误码设计与状态码
  - 业务错误码的扩展





## 格式

**统一格式：**A-BB-CC。

|      | 定义               | 具体值                                 |
| :--- | :----------------- | :------------------------------------- |
| A    | 错误级别           | 1代表系统级错误，2代表具体业务模块错误 |
| BB   | 定义具体的错误模块 | 00-99自增即可                          |
| CC   | 具体错误编号       | 00-99自增即可                          |

**补充说明：**

1. 错误码暂定都是5位数字
2. 错误码为 **0** 表示成功
3. 数字 **1** 开头的错误码表示系统级别的错误，比如无效token，无效url，无效请求参数之类的，系统级的错误码不需要分模块，可以按照自增方式进行添加

**举例说明：**20105

| 2            | 01                   | 05           |
| ------------ | -------------------- | ------------ |
| 业务模块错误 | 业务模块代码（用户） | 具体错误代码 |





## 系统级错误码

| 错误码 | 错误信息          | 详细描述               |
| ------ | ----------------- | ---------------------- |
| 10001  | 系统错误          |                        |
| 10002  | 无效token         | token缺失或者非法token |
| 10003  | 无权访问          | 无权访问此url          |
| 10004  | 不支持的MediaType |                        |
| 10005  | 接口不存在        | 无效请求               |
| 10006  | 无效参数          | 参数错误               |
| 10007  | 参数为空          |                        |
| 10008  | 参数类型错误      |                        |
| 10009  | 数据不存在        |                        |
| 10010  | 数据已存在        |                        |
|        |                   |                        |





## 业务模块错误码



### 业务对应编码

| 编码 | 错误信息          |
| ---- | ----------------- |
| 01   | 用户（角色、权限等）          |
| 02   | 机构单位、人员        |



### 业务错误码



| 错误码 | 错误信息                       | 详细描述 |
| ------ | ------------------------------ | -------- |
| 20101  | 用户名不存在或密码错误         |          |
| 20102  | 管理员角色无法删除             |          |
| 20103  | 身份证已被使用                       |          |
| 20104  | 存在人员，不能删除              |          |
| 20105  | 角色已被使用，无法删除                     |          |
| 20106  | 用户组已被使用，无法删除       |          |
| 20107  | 该标签已经有人在使用，无法删除 |          |
| 20202  | 存在子级单位，不能删除         |          |
|        |                                |          |



## 补充说明

### 关于HTTP状态码

HTTP状态码由三个十进制数字组成，第一个十进制数字定义了状态码的类型，后两个数字没有分类的作用。HTTP状态码共分为5种类型。

| 分类 | 分类描述                                       |
| :--- | :--------------------------------------------- |
| 1**  | 信息，服务器收到请求，需要请求者继续执行操作   |
| 2**  | 成功，操作被成功接收并处理                     |
| 3**  | 重定向，需要进一步的操作以完成请求             |
| 4**  | 客户端错误，请求包含语法错误或无法完成请求     |
| 5**  | 服务器错误，服务器在处理请求的过程中发生了错误 |

### 错误码设计与状态码

注意以下几点：

1. 部分API错误码设计，是把错误代码依次映射到HTTP的状态码
2. API错误和HTTP状态码，不应该有任何业务耦合，一个应用层的API不应该侵入到HTTP协议层的状态码



### 业务错误码的扩展

部分业务错误，比如用户已存在，角色已存在等，可以抽象度高一点，归纳到系统级错误：数据已存在。这时候，返回给前端的错误码是同一个，但msg可以自定义。推荐在内部项目中这样处理，好处如下：

1. 不必费更多心思在拓展业务码上
2. 后端处理比较方便（但可能出现部分魔法值）